{% extends "layout.html" -%}
{% set active_page="admin" -%}
{% block body %}
<h2>Administration</h2>
<hr>
<div class="col-md-12">
<div class="col-md-3">
<h3>Management:</h3>
<button class="btn btn-default" ><a href="/update" role="button">Update Spc-Eyepi</a></button>
<button class="btn btn-danger" ><a href="/reboot" role="button">Reboot</a></button>
</div>
<h3>Users:</h3>
<div class="panel panel-default col-md-9">
<table class="table">
{% for username in usernames %}
<tr>
	<td>{{username}}</td>
	<td><input type="password" id="{{username}}-pass" class="form-control" placeholder="Password"></td>
	<td><button class="btn btn-warning btn-md" data-toggle="modal" data-target="#{{username}}-confirm-modal">Save</button></td>
<tr>
{% endfor %}
</table>
</div>
</div>
<div class="modal fade" id="{{username}}-confirm-modal" tabindex="-1" role="dialog" aria-labelledby="{{username}}-confirm-modal-label" aria-hidden="true">
   <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title" id="{{username}}-confirm-modal-label">Are You SURE?</h4>
        </div>
        <div class="modal-body">
        <p>Invalid password or not enough</p>
        </div>
      </div>
   </div>
</div>

{% for username in usernames %}
<div class="modal fade" id="{{username}}-confirm-modal" tabindex="-1" role="dialog" aria-labelledby="{{username}}-confirm-modal-label" aria-hidden="true">
   <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title" id="{{username}}-confirm-modal-label">Are You SURE?</h4>
        </div>
        <div class="modal-body">
        <p>Please type either that users password or the admin password</p><br><input type="password" id="{{username}}-pass-confirm" class="form-control" placeholder="Password">
        </div>
grape        <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">I'm not sure...</button>
        <button id="{{username}}-save-button" type="button" class="btn btn-danger">Do it</button>
        </div>
      </div>
   </div>
</div>

<script type="text/javascript">
$("#{{username}}-save-button").click(function(e){
      e.preventDefault();
      $.post('/newuser',
         {username:"{{username}}",pass:$("#{{username}}-pass").val(),adminpass:$("#{{username}}-pass-confirm").val()},
         function(data, status, xhr){
           console.log(data);
           if(data =="success"){
                $("#{{username}}-save-button").toggleClass("btn-success")
                setTimeout(function(){
                        $("#{{username}}-confirm-modal").modal("hide")
                },2000)
           }else if(data=="invalid"){
		$("#{{username}}-confirm-modal").modal("hide")
		$("#invalid-modal").modal("show")
		setTimeout(function(){
			$("#invalid-modal").modal("hide")
		}, 3000)
          }
	});
});
</script>
{% endfor %}
{% endblock %}
